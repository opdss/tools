{% extends "layout.twig" %}

{% block container %}
    <div class="row">
        <h3 class="page-header">{{ current_menu[1] }}</h3>
        <div class="row">
            <div class="col-md-12">
                <form class="form-inline ">
                    <div class="form-group">
                        <label for="idcard">输入身份证号码：</label>
                        <input type="email" class="form-control" id="idcard" placeholder="身份证号码">
                    </div>
                    <button type="submit" id="idcard_verify" class="btn btn-info">校验</button>
                    <span class="form-inline" style="color: red;" id="error"></span>
                </form>
            </div>
            <hr>
            <div class="col-md-12">
                <div class="well" id="ic-info">
                    <p id="ic">身份证号码：<span></span></p>
                    <p id="zone">地区：<span></span></p>
                    <p id="bothday">生日：<span></span></p>
                    <p id="sex">性别：<span></span></p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <h3 class="page-header">随机批量生成有效身份证号码</h3>
        <div class="row">
            <div class="col-md-12">
                <form class="form-inline ">
                    {#<div class="form-group">
                        <label for="idcard">输入身份证号码：</label>
                        <input type="email" class="form-control" id="idcard" placeholder="身份证号码">
                    </div>#}
                    <button type="submit" id="idcard_gen" class="btn btn-info">批量生成身份证号码</button>
                    <span class="form-inline" style="color: red;" id="error"></span>
                </form>
            </div>
            <hr>
            <div class="col-md-12">
                <div class="well" id="ic-list">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <td>身份证号码</td>
                                <td>地区</td>
                                <td>生日</td>
                                <td>性别</td>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block script %}
    <script type="text/javascript">

        $('#ic-info').show();
        $('#idcard_verify').click(function (e) {
            var error = function (msg) {
                $('#error').text(msg);
            }
            var idcard = $('#idcard').val();
            if (!utils.isIC(idcard)) {
                error('错误的身份证号码！');
            } else {
                error('');
                $.get('/api/idcard', {ic:idcard}, function (res) {
                    if (res.errCode == 0) {
                        console.log(res);
                        $.each(res.data, function (k, v) {
                            $('#'+k).find('span').text(v);
                        })
                    } else {
                        error('错误的身份证号码');
                    }
                }, 'json')
            }
            return false;
        });
        $('#idcard_gen').click(function () {
            $.get('/api/genicard?number=10', function (res) {
                if (res.errCode == 0) {
                    console.log(res);
                    var html = '';
                    $.each(res.data, function (k, v) {
                        //console.log(k,v);
                        html += '<tr> <td>'+v.ic+'</td><td>'+v.zone+'</td> <td>'+v.bothday+'</td> <td>'+v.sex+'</td> </tr>'
                    })
                    $('#ic-list').find('tbody').html(html);
                } else {
                    error('错误的身份证号码');
                }
            }, 'json');
            return false;
        })
    </script>
{% endblock %}